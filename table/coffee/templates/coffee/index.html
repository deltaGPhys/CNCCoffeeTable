<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes">
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    
    <script>
        var baseUrl=document.location.href.split('/').slice(0,3).join('/')+'/';
        var patternCount = 0;
        var pkList;
        var CurrentPattern = 0;
        
    function patternCounter() {
        
       $.ajax({ // create an AJAX call...
               type: 'GET',
               url: baseUrl + 'countPatterns/',
               dataType: 'json',
               success: function(response) { // on success..
                   patternCount = response['Count'];
                   pkList = response['pks'];
                   $("#patternchoice").attr('max',patternCount-1);
                                            
                   CurrentPattern = pkList[0];
                                             console.log('counter complete');
               }
        });
    };

    patternCounter();

    function loadPattern(id) {
           $.ajax({ // create an AJAX call...
                   data : {'id':id},
                   type: 'GET',
                   url: baseUrl + 'loadPattern/',
                   dataType: 'json',
                   success: function(response) { // on success..
                       $("#CurrentImages").attr('src',response['Photo']);
                       $("#CurrentBlueprint").attr('src',response['Blueprint']);
                       $("#CurrentPhoto").attr('src',response['Photo']);                         
                       $("#CurrentCardTitle").html(response['Name']);
                       $("#CurrentCardType").html("Path Type: "+response['Type']);
                       $("#CurrentCardDescription").html(response['Description']);
                       $("#CurrentCardDuration").html(response['Duration']);
                       
                   }
            });
    };


    </script>
   
    <title>CNCCoffee</title>
  </head>
  <body>

      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" type="button" id="MainMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-bars"></i>
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          <a class="dropdown-item" id="PatternAddButton" data-toggle="modal" data-target="#PatternAddModal">Add Pattern</a>
          <a class="dropdown-item" href="#">Another action</a>
          <a class="dropdown-item" href="#">Something else here</a>
        </div>
      </div>
  
</div>
    <style>
* {box-sizing: border-box;}

.img-comp-container {
  position: relative;
  height: 200px; /*should be the same height as the images*/
}

.img-comp-img {
  position: absolute;
  width: auto;
  height: auto;
  overflow: hidden;
}

.img-comp-img img {
  display: block;
  vertical-align: middle;
}
.center {
    display: block;
    margin-left: auto;
    margin-right: auto;
    
}

    </style>
<br>
    <input type="range" id="patternchoice" min="0" value="0" step="1" style="width:85%" class="center">
       <br>
          <script>
            $("#patternchoice").on("input", function(){

                CurrentPattern = pkList[this.value];
                loadPattern(CurrentPattern);
                });
          </script>
    
    <div class="card" id="CurrentCard" style="width:100%">
      
      <div class="img-comp-container center" style="width:85%">
      
        <div class="img-comp-img" style="width:100%">
          <img id="CurrentBlueprint" src="" width="100%" height="200">
        </div>
        <div class="img-comp-img img-comp-overlay" id="CurrentOverlay"mstyle="width:100%">
          <img id="CurrentPhoto" src="" width="100%" height="200">
        </div>
        
      </div>
        <br>
        
          <input type="range" id="opacity" min="0" max="1" value="0" step=".02" style="width:85%" class="center">
       
          <script>
            $("#opacity").on("input", function(){
                $("#CurrentOverlay").css('opacity',this.value);
                });
          </script>
      <div class="card-body">
        <h5 class="card-title"><span id="CurrentCardTitle"></span></h5>
        <p class="card-text"><span id="CurrentCardType"></span></p>
        <p class="card-text"><span id="CurrentCardDescription"></span></p>
        <a href="#" class="btn btn-success" id="BeginBtn">Begin (<span id="CurrentCardDuration"></span>)</a>
      </div>
    </div>
    <script>
      $(document).ready(function() {
          console.log('ready');

          loadPattern(CurrentPattern);
          
 
 
        $(document).on("click", "#BeginBtn", function () {
            
           $.ajax({ // create an AJAX call...
                   data : {'id':4},
                   type: 'GET',
                   url: baseUrl + 'loadPattern/',
                   dataType: 'json',
                   success: function(response) { // on success..
                       $("#CurrentImages").attr('src',response['Photo']);
                       $("#CurrentBlueprint").attr('src',response['Blueprint']);
                       $("#CurrentPhoto").attr('src',response['Photo']);                         
                       $("#CurrentCardTitle").html(response['Name']);
                       $("#CurrentCardType").html("Path Type: "+response['Type']);
                       $("#CurrentCardDescription").html(response['Description']);
                       $("#CurrentCardDuration").html(response['Duration']);
                       
                   }
            });
         });

       });

      </script>

    
    <br>
    
    <div class="jumbotron jumbotron-fluid" id="FeedbackBox">
      <div class="container">
        
        <p class="lead" id="FeedbackText"></p>
      </div>
    </div>




    <!-- MODALS -->
    <!-- Feedback add modal -->

    <div class="modal fade" id="PatternAddModal" role="dialog">
    <div class="modal-dialog">

      <!-- Modal content-->
      <div class="modal-content">
      <div class="modal-header" style="padding:5px 10px;">
        <button type="button" class="close" data-dismiss="modal">&times;</button>

        <h4>Add Pattern</h4>
      </div>
      <div class="modal-body" style="padding:10px 10px;">

        <form name="PatternAddForm" id="patternaddform">
          {% csrf_token %}
          {{ patternaddform.as_p }}

      </div>
      <div class="modal-footer">
        <button class="btn-submit" id ="AddPatternBtn" name="AddPattern">Add Pattern</button>
      </form>
      </div>
      </div>
      <script>
      $(document).ready(function() {
        $(document).on("click", "#AddPatternBtn", function () {
          console.log("yup");
         });

         $('#patternaddform').submit(function(e){
           e.preventDefault();

           var formdata = $(this).serialize()

           console.log(formdata);
           $.ajax({ // create an AJAX call...
                   data: formdata, // get the form data
                   type: 'POST',
                   url: baseUrl + 'addPattern/',
                   dataType: 'json',
                   success: function(response) { // on success..
                       $("#FeedbackText").html(response['message']);
                       $("#FeedbackBox").css({'background-color':'green'});
                       $('#PatternAddModal').modal('hide'); // close this
                   }
            });
         });

       });

      </script>
    </div>
    </div>



  </body>
</html>
